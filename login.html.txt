<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart HSR | تسجيل الدخول</title>
    
    <link rel="stylesheet" href="output.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Professional & Executive Palette */
            --color-navy: #0A1931;
            /* Primary Dark Color */
            --color-teal: #18A5A2;
            /* Accent/Highlight Color */
            --color-gray-bg: #F7F9FC;
            /* Clean Background */
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--color-gray-bg);
            color: var(--color-navy);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            border-top: 5px solid var(--color-teal);
        }

        .ai-button-primary {
            background-color: var(--color-teal);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(24, 165, 162, 0.5);
        }

        .ai-button-primary:hover:not(:disabled) {
            background-color: #148f8c;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(24, 165, 162, 0.8);
        }
    </style>
</head>

<body>

    <div class="login-card text-center">
        <div class="mb-8">
            <h1 class="text-4xl font-extrabold" style="color: var(--color-navy);">Smart HSR</h1>
            <h2 class="text-xl font-medium mt-1 text-gray-600">تسجيل الدخول إلى لوحة القيادة</h2>
        </div>

        <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
            <div class="mb-6 text-right">
                <label for="email" class="block text-sm font-medium mb-2" style="color: var(--color-navy);">البريد
                    الإلكتروني</label>
                <input type="email" id="email" required
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[--color-teal] focus:border-[--color-teal] transition-all"
                    placeholder="example@domain.com">
            </div>

            <div class="mb-6 text-right">
                <label for="password" class="block text-sm font-medium mb-2" style="color: var(--color-navy);">كلمة
                    المرور</label>
                <input type="password" id="password" required
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[--color-teal] focus:border-[--color-teal] transition-all"
                    placeholder="******">
            </div>

            <div id="errorMessage" class="text-red-600 font-medium text-sm mb-4 hidden"></div>

            <button type="submit" id="loginButton"
                class="ai-button-primary w-full rounded-full px-6 py-3 text-lg font-bold mt-4 flex items-center justify-center">
                <i data-lucide="log-in" class="w-5 h-5 ml-2"></i> تسجيل الدخول
            </button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

        // 🔴 لا تقم بتعديل هذا الكود - هذا هو كود ربط مشروعك بـ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC5HTAq-LeJn4GObn08REwKdqIeokKmwds",
            authDomain: "smart-hsr.firebaseapp.com",
            projectId: "smart-hsr",
            storageBucket: "smart-hsr.firebasestorage.app",
            messagingSenderId: "885545362431",
            appId: "1:885545362431:web:2487096393f0fcbf29bdca"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const loginButton = document.getElementById('loginButton');
        const errorMessageElement = document.getElementById('errorMessage');

        window.handleLogin = function () {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // إخفاء رسالة الخطأ السابقة
            errorMessageElement.classList.add('hidden');
            errorMessageElement.innerText = '';
            
            // تعطيل الزر وعرض التحميل
            loginButton.disabled = true;
            loginButton.innerHTML = `<i data-lucide="loader-circle" class="w-5 h-5 ml-2 animate-spin"></i> جاري التحقق...`;
            lucide.createIcons(); // لتحديث الأيقونة

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // تسجيل الدخول ناجح
                    const user = userCredential.user;
                    console.log("Login successful, user:", user.uid);
                    
                    // ✅ التوجيه إلى صفحة لوحة القيادة (index.html)
                    window.location.href = "index.html"; 
                })
                .catch((error) => {
                    const errorCode = error.code;
                    let message = "حدث خطأ غير متوقع في تسجيل الدخول.";

                    // ترجمة رسائل الخطأ الشائعة
                    if (errorCode === 'auth/invalid-email') {
                        message = "صيغة البريد الإلكتروني غير صحيحة.";
                    } else if (errorCode === 'auth/user-not-found' || errorCode === 'auth/wrong-password') {
                        message = "البريد الإلكتروني أو كلمة المرور غير صحيحة. يرجى التحقق.";
                    } else if (errorCode === 'auth/too-many-requests') {
                        message = "تم حظر هذا الجهاز مؤقتاً بسبب محاولات متكررة فاشلة. يرجى المحاولة لاحقاً.";
                    }
                    
                    errorMessageElement.innerText = message;
                    errorMessageElement.classList.remove('hidden');

                    // تفعيل الزر وإعادة نص تسجيل الدخول
                    loginButton.disabled = false;
                    loginButton.innerHTML = `<i data-lucide="log-in" class="w-5 h-5 ml-2"></i> تسجيل الدخول`;
                    lucide.createIcons(); // لتحديث الأيقونة
                });
        }
        
        // إنشاء أيقونات lucide عند تحميل الصفحة
        window.onload = () => {
             lucide.createIcons();
        };

    </script>
</body>

</html>
